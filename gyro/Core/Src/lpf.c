#include "lpf.h"

/**************************************************************
WinFilter version 0.8
http://www.winfilter.20m.com
akundert@hotmail.com

Filter type: Low Pass
Filter model: Bessel
Filter order: 2
Sampling Frequency: 400 Hz
Cut Frequency: 3.000000 Hz
Coefficents Quantization: float

Z domain Zeros
z = -1.000000 + j 0.000000
z = -1.000000 + j 0.000000

Z domain Poles
z = 0.986458 + j -0.007748
z = 0.986458 + j 0.007748
***************************************************************/

float fir(float NewSample) {
    float FIRCoef[Ntap] = { 
0.00047870165618619159,
        0.00092147329212002307,
        0.00147987860976642420,
        0.00217048247515662290,
        0.00301042464281510480,
        0.00401705944048822830,
        0.00520749395172630940,
        0.00659801158136208950,
        0.00820336765229486180,
        0.01003594369809296400,
        0.01210474743165000300,
        0.01441424603336100400,
        0.01696302146064617200,
        0.01974223798014685900,
        0.02273391410721056800,
        0.02590899364180534300,
        0.02922521354579858700,
        0.03262477003387898700,
        0.03603178845726489500,
        0.03934960733865291300,
        0.04245789224374782500,
        0.04520960100363586400,
        0.04742782806434299400,
        0.04890256234027640100,
        0.04942563342700212500,
        0.04890256234027640100,
        0.04742782806434299400,
        0.04520960100363586400,
        0.04245789224374782500,
        0.03934960733865291300,
        0.03603178845726489500,
        0.03262477003387898700,
        0.02922521354579858700,
        0.02590899364180534300,
        0.02273391410721056800,
        0.01974223798014685900,
        0.01696302146064617200,
        0.01441424603336100400,
        0.01210474743165000300,
        0.01003594369809296400,
        0.00820336765229486180,
        0.00659801158136208950,
        0.00520749395172630940,
        0.00401705944048822830,
        0.00301042464281510480,
        0.00217048247515662290,
        0.00147987860976642420,
        0.00092147329212002307,
        0.00047870165618619159,
        0.00013584520814374418
    };

    static float x[Ntap]; //input samples
    float y=0;            //output sample
    int n;

    //shift the old samples
    for(n=Ntap-1; n>0; n--)
       x[n] = x[n-1];

    //Calculate the new output
    x[0] = NewSample;
    for(n=0; n<Ntap; n++)
        y += FIRCoef[n] * x[n];
    
    return y;
}
